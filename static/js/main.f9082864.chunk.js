(this["webpackJsonpbin-packing-frontend"]=this["webpackJsonpbin-packing-frontend"]||[]).push([[0],{115:function(t,e,n){"use strict";n.r(e);var a=n(5),i=n(43),r=n.n(i),o=(n(49),n(14)),l=n(11),c=n(8),u=n(9),s=n(13),h=n(12),d=n(0),g=function(){return Object(d.jsx)("div",{className:"header-container",children:Object(d.jsx)("header",{children:Object(d.jsx)("h1",{children:"Bin Packing Algorithms"})})})},p=n(23),f=function(t){var e=t.label,n=t.name,a=t.value,i=t.onChange;return Object(d.jsxs)("div",{className:"numerical-input-form-row",children:[Object(d.jsx)("label",{htmlFor:n,children:e}),Object(d.jsx)("input",{id:n,name:n,type:"number",value:a,onChange:i})]})},b=function(){function t(){Object(c.a)(this,t)}return Object(u.a)(t,null,[{key:"getAll",value:function(){return[{id:"greedy randomSelection",name:"Greedy - Random Selection"},{id:"greedy sizeOrdered",name:"Greedy - Size-ordered"},{id:"localSearch geometryBased",name:"Local Search - Geometry-based"},{id:"localSearch eventuallyFeasibleGeometryBased",name:"[WiP] Local Search - Geometry-based (eventually feasible)"}]}},{key:"getDefaultStrategyId",value:function(){return this.getAll()[0].id}}]),t}(),m=function(t){var e=b.getAll().map((function(t){return Object(d.jsx)("option",{value:t.id,children:t.name},t.id)}));return Object(d.jsx)("div",{className:"strategy-selector-form-row",children:Object(d.jsx)("select",{id:"strategy",name:"strategy",onChange:t.onChange,onLoad:t.onChange,children:e})})},j=function(t){Object(s.a)(n,t);var e=Object(h.a)(n);function n(t){var a;return Object(c.a)(this,n),(a=e.call(this,t)).handleNumericalInputChange=a.handleInputChange(parseInt),a.handleTextualInputChange=a.handleInputChange((function(t){return t})),a.state={strategy:b.getDefaultStrategyId(),boxLength:"",numRectangles:"",minWidth:"",maxWidth:"",minHeight:"",maxHeight:""},a}return Object(u.a)(n,[{key:"handleInputChange",value:function(t){var e=this;return function(n){return function(a){e.setState((function(e){return Object(l.a)(Object(l.a)({},e),{},Object(p.a)({},n,t(a.target.value)))}))}}}},{key:"startWithoutPageRefresh",value:function(t){t.preventDefault(),this.props.start(this.state.strategy,this.state.boxLength,this.state.numRectangles,this.state.minWidth,this.state.maxWidth,this.state.minHeight,this.state.maxHeight)}},{key:"render",value:function(){return Object(d.jsxs)("div",{className:"input-form",children:[Object(d.jsx)("h3",{children:"Algorithm Input"}),Object(d.jsxs)("form",{children:[Object(d.jsx)(m,{onChange:this.handleTextualInputChange("strategy").bind(this)}),Object(d.jsx)(f,{label:"Box Length",name:"box-length",value:this.state.boxLength,onChange:this.handleNumericalInputChange("boxLength").bind(this)}),Object(d.jsx)(f,{label:"Number of Rectangles",name:"num-rectangles",value:this.state.numRectangles,onChange:this.handleNumericalInputChange("numRectangles").bind(this)}),Object(d.jsx)(f,{label:"Min. Width",name:"min-width",value:this.state.minWidth,onChange:this.handleNumericalInputChange("minWidth").bind(this)}),Object(d.jsx)(f,{label:"Max. Width",name:"max-width",value:this.state.maxWidth,onChange:this.handleNumericalInputChange("maxWidth").bind(this)}),Object(d.jsx)(f,{label:"Min. Height",name:"min-height",value:this.state.minHeight,onChange:this.handleNumericalInputChange("minHeight").bind(this)}),Object(d.jsx)(f,{label:"Max. Height",name:"max-height",value:this.state.maxHeight,onChange:this.handleNumericalInputChange("maxHeight").bind(this)}),Object(d.jsx)("div",{className:"input-form-button-container",children:Object(d.jsx)("button",{onClick:this.startWithoutPageRefresh.bind(this),children:"Start"})})]})]})}}]),n}(a.Component),v=n(18),O=n(45),x=n.n(O),S=function(t){Object(s.a)(n,t);var e=Object(h.a)(n);function n(){var t;Object(c.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))).boxFillColor="white",t.boxBorderColor="black",t.rectangleFillColorBase="#D6E9FE",t.rectangleFillColorLatestUpdate="#5995DA",t.rectangleBorderColor="#5995DA",t.rectangleHighlightDuration=10,t.rectangleFillColormap=x()([t.rectangleFillColorBase,t.rectangleFillColorLatestUpdate]),t}return Object(u.a)(n,[{key:"render",value:function(){var t=this,e=this.props,n=e.id,a=e.unitLength,i=e.pixelLength,r=e.getRectangles,o=e.currentStep;function l(t){return t/a*i}var c=r().map((function(e,n){return function(e){var n=Math.max(0,(e.lastUpdate-o+t.rectangleHighlightDuration)/t.rectangleHighlightDuration);return Object(d.jsx)(v.c,{x:l(e.x),y:l(e.y),width:l(e.width),height:l(e.height),fill:t.rectangleFillColormap(n),stroke:t.rectangleBorderColor})}(e)}));return Object(d.jsx)("div",{className:"box",id:n,children:Object(d.jsx)(v.d,{width:i,height:i,children:Object(d.jsxs)(v.b,{children:[Object(d.jsx)(v.c,{x:0,y:0,width:i,height:i,fill:this.boxFillColor,stroke:this.boxBorderColor}),Object(d.jsx)(v.a,{x:0,y:0,children:c})]})})})}}]),n}(a.Component),I=function(t){Object(s.a)(n,t);var e=Object(h.a)(n);function n(){var t;Object(c.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))).getCurrentSolutionStep=t.props.getCurrentSolutionStep,t.getRectanglesLastUpdate=t.props.getRectanglesLastUpdate,t.state={placement:[]},t.boxPixelLength=300,t}return Object(u.a)(n,[{key:"getRectanglesLastUpdateWithZeroDefault",value:function(t){var e=this.getRectanglesLastUpdate()[t];return void 0!==e?e:0}},{key:"getRectangles",value:function(t){var e=this;return function(){return e.state.placement.filter((function(e){return e.box.id===t})).map((function(t){return{x:t.coordinates.x,y:t.coordinates.y,width:t.rectangle.width,height:t.rectangle.height,lastUpdate:e.getRectanglesLastUpdateWithZeroDefault(t.rectangle.id)}}))}}},{key:"getUnique",value:function(t){return Object(o.a)(new Set(t.map((function(t){return t.id})))).map((function(e){return t.find((function(t){return t.id===e}))}))}},{key:"render",value:function(){var t=this,e=this.getCurrentSolutionStep();void 0!==e&&e.solution.placement!==this.state.placement&&(this.setState({placement:e.solution.placement}),console.log("Visualize solution step "+e.step+" for run with id "+e.runId));var n=this.getUnique(this.state.placement.map((function(t){return t.box}))).sort((function(t,e){return t.id-e.id})).map((function(n){return Object(d.jsx)(S,{id:n.id,unitLength:n.length,pixelLength:t.boxPixelLength,getRectangles:t.getRectangles(n.id),currentStep:e.step})}));return Object(d.jsx)("div",{className:"algorithm-display",children:Object(d.jsx)("div",{className:"boxes-container",children:n})})}}]),n}(a.Component),y=function(t){Object(s.a)(n,t);var e=Object(h.a)(n);function n(t){var a;return Object(c.a)(this,n),(a=e.call(this,t)).state={visualizationIterationPeriod:a.props.visualizationIterationPeriodDefault},a}return Object(u.a)(n,[{key:"handleMsPerIterationChange",value:function(t){var e=t.target.value;this.setState({visualizationIterationPeriod:e}),this.props.updateVisualizationIterationPeriod(e)}},{key:"render",value:function(){return Object(d.jsxs)("div",{className:"visualization-config-form",children:[Object(d.jsx)("h3",{children:"Visualization Config"}),Object(d.jsx)("form",{children:Object(d.jsx)(f,{label:"ms / Iteration",name:"ms-per-iteration",value:this.state.visualizationIterationPeriod,onChange:this.handleMsPerIterationChange.bind(this)})})]})}}]),n}(a.Component),C=function(t){Object(s.a)(n,t);var e=Object(h.a)(n);function n(){return Object(c.a)(this,n),e.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){var t=this.props,e=t.getCurrentSolutionStep,n=t.getRectanglesLastUpdate,a=t.start,i=t.visualizationIterationPeriodDefault,r=t.updateVisualizationIterationPeriod;return Object(d.jsxs)("div",{className:"content-container",children:[Object(d.jsxs)("div",{className:"input-container",children:[Object(d.jsx)(j,{start:a}),Object(d.jsx)(y,{visualizationIterationPeriodDefault:i,updateVisualizationIterationPeriod:r})]}),Object(d.jsx)(I,{getCurrentSolutionStep:e,getRectanglesLastUpdate:n})]})}}]),n}(a.Component),k=n(19),L=n.n(k),R=function(){function t(){Object(c.a)(this,t);var e="https://bin-packing-backend.herokuapp.com";"undefined"==typeof e&&(e="http://localhost:9000"),L.a.defaults.baseURL=e,console.info("Setup API connection to "+L.a.defaults.baseURL)}return Object(u.a)(t,[{key:"startAlgorithm",value:function(t,e,n,a,i,r,o){return function(l){console.trace("Starting algorithm"),L.a.put("/binPacking/start",{strategy:t,boxLength:e,numRectangles:n,rectanglesWidthRange:{min:a,max:i},rectanglesHeightRange:{min:r,max:o}}).then((function(t){return l(t)}))}}},{key:"fetchSolutionSteps",value:function(t,e,n){return function(a){console.trace("Fetching steps "+e+" - "+n+" for runId "+t),L.a.get("/binPacking/steps",{params:{runId:t,minStep:e,maxStep:n}}).then((function(t){return a(t)}))}}}]),t}(),F=function(){function t(){Object(c.a)(this,t)}return Object(u.a)(t,null,[{key:"zipPlacementsByRectangleId",value:function(t,e){function n(t,e){return t.rectangle.id-e.rectangle.id}return function t(e,a){if(0===e.length)return a.map((function(t){return{left:null,right:t}}));if(0===a.length)return e.map((function(t){return{left:t,right:null}}));var i=e[0],r=a[0],l=n(i,r);return 0===l?[{left:i,right:r}].concat(Object(o.a)(t(e.slice(1),a.slice(1)))):l<0?[{left:i,right:null}].concat(Object(o.a)(t(e.slice(1),a))):[{left:null,right:r}].concat(Object(o.a)(t(e,a.slice(1))))}(Object(o.a)(t).sort(n),Object(o.a)(e).sort(n))}}]),t}();function P(t){return t[t.length-1]}var U=function(t){Object(s.a)(n,t);var e=Object(h.a)(n);function n(){var t;Object(c.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))).fetchSolutionStepsPeriod=100,t.fetchSolutionStepsCount=100,t.visualizationIterationPeriodDefault=100,t.backendClient=new R,t.state={running:!1,runId:"",fetchBlocked:!1,solutionStepQueue:[],rectanglesLastUpdate:{}},t.getCurrentSolutionStep=function(){return t.state.solutionStepQueue[0]},t.getRectanglesLastUpdate=function(){return t.state.rectanglesLastUpdate},t.start=function(e,n,a,i,r,o,c){t.backendClient.startAlgorithm(e,n,a,i,r,o,c)((function(e){console.log(e),t.setState((function(t){return Object(l.a)(Object(l.a)({},t),{},{running:!0,runId:e.data.runId,solutionStepQueue:[e.data],rectanglesLastUpdate:{}})}))}))},t.blockFetch=function(){t.setState((function(t){return Object(l.a)(Object(l.a)({},t),{},{fetchBlocked:!0})}))},t.fetchSolutionSteps=function(){t.blockFetch();var e=P(t.state.solutionStepQueue).step;t.backendClient.fetchSolutionSteps(t.state.runId,e+1,e+t.fetchSolutionStepsCount)((function(e){console.log(e);var n=e.data.length>0&&P(e.data).finished;t.setState((function(a){return Object(l.a)(Object(l.a)({},a),{},{running:!n,fetchBlocked:!1,solutionStepQueue:[].concat(Object(o.a)(t.state.solutionStepQueue),Object(o.a)(e.data))})}))}))},t.getUpdatedRectangleIdsInNewStep=function(t,e){return F.zipPlacementsByRectangleId(t.solution.placement,e.solution.placement).map((function(t){return null===t.left?t.right.rectangle.id:null===t.right||t.left.coordinates.x!==t.right.coordinates.x||t.left.coordinates.y!==t.right.coordinates.y?t.left.rectangle.id:null})).filter((function(t){return null!==t}))},t.removeFirstSolutionStepFromQueue=function(){if(t.state.solutionStepQueue.length>1){var e=t.state.solutionStepQueue[0],n=t.state.solutionStepQueue.slice(1),a=n[0],i=Object(l.a)({},t.state.rectanglesLastUpdate);t.getUpdatedRectangleIdsInNewStep(e,a).forEach((function(t){return i[t]=a.step})),t.setState((function(t){return Object(l.a)(Object(l.a)({},t),{},{solutionStepQueue:n,rectanglesLastUpdate:i})}))}},t}return Object(u.a)(n,[{key:"updateRemoveFirstSolutionStepFromQueueInterval",value:function(t){clearInterval(this.removeFirstSolutionStepFromQueueInterval),this.removeFirstSolutionStepFromQueueInterval=setInterval(this.removeFirstSolutionStepFromQueue,t)}},{key:"componentDidMount",value:function(){var t=this;this.fetchSolutionStepsInterval=setInterval((function(){t.state.running&&!t.state.fetchBlocked&&t.fetchSolutionSteps()}),this.fetchSolutionStepsPeriod),this.removeFirstSolutionStepFromQueueInterval=setInterval(this.removeFirstSolutionStepFromQueue,this.visualizationIterationPeriodDefault)}},{key:"componentWillUnmount",value:function(){clearInterval(this.fetchSolutionStepsInterval),clearInterval(this.removeFirstSolutionStepFromQueueInterval)}},{key:"render",value:function(){return Object(d.jsxs)("div",{className:"main",children:[Object(d.jsx)(g,{}),Object(d.jsx)(C,{getCurrentSolutionStep:this.getCurrentSolutionStep,getRectanglesLastUpdate:this.getRectanglesLastUpdate,start:this.start,visualizationIterationPeriodDefault:this.visualizationIterationPeriodDefault,updateVisualizationIterationPeriod:this.updateRemoveFirstSolutionStepFromQueueInterval.bind(this)})]})}}]),n}(a.Component);r.a.render(Object(d.jsx)(U,{}),document.getElementById("root"))},49:function(t,e,n){}},[[115,1,2]]]);
//# sourceMappingURL=main.f9082864.chunk.js.map