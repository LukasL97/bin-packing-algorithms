(this["webpackJsonpbin-packing-frontend"]=this["webpackJsonpbin-packing-frontend"]||[]).push([[0],{115:function(t,e,n){"use strict";n.r(e);var a=n(6),i=n(43),r=n.n(i),o=(n(49),n(12)),c=n(11),l=n(8),u=n(9),s=n(14),h=n(13),g=n(0),d=function(){return Object(g.jsx)("div",{className:"header-container",children:Object(g.jsx)("header",{children:Object(g.jsx)("h1",{children:"Bin Packing Algorithms"})})})},p=n(23),f=function(t){var e=t.label,n=t.name,a=t.value,i=t.onChange;return Object(g.jsxs)("div",{className:"numerical-input-form-row",children:[Object(g.jsx)("label",{htmlFor:n,children:e}),Object(g.jsx)("input",{id:n,name:n,type:"number",value:a,onChange:i})]})},b=function(){function t(){Object(l.a)(this,t)}return Object(u.a)(t,null,[{key:"getAll",value:function(){return[{id:"greedy randomSelection",name:"Greedy - Random Selection"},{id:"localSearch geometryBased",name:"Local Search - Geometry-based"}]}},{key:"getDefaultStrategyId",value:function(){return this.getAll()[0].id}}]),t}(),m=function(t){var e=b.getAll().map((function(t){return Object(g.jsx)("option",{value:t.id,children:t.name},t.id)}));return Object(g.jsx)("div",{className:"strategy-selector-form-row",children:Object(g.jsx)("select",{id:"strategy",name:"strategy",onChange:t.onChange,onLoad:t.onChange,children:e})})},j=function(t){Object(s.a)(n,t);var e=Object(h.a)(n);function n(t){var a;return Object(l.a)(this,n),(a=e.call(this,t)).handleNumericalInputChange=a.handleInputChange(parseInt),a.handleTextualInputChange=a.handleInputChange((function(t){return t})),a.state={strategy:b.getDefaultStrategyId(),boxLength:"",numRectangles:"",minWidth:"",maxWidth:"",minHeight:"",maxHeight:""},a}return Object(u.a)(n,[{key:"handleInputChange",value:function(t){var e=this;return function(n){return function(a){e.setState((function(e){return Object(c.a)(Object(c.a)({},e),{},Object(p.a)({},n,t(a.target.value)))}))}}}},{key:"startWithoutPageRefresh",value:function(t){t.preventDefault(),this.props.start(this.state.strategy,this.state.boxLength,this.state.numRectangles,this.state.minWidth,this.state.maxWidth,this.state.minHeight,this.state.maxHeight)}},{key:"render",value:function(){return Object(g.jsx)("div",{className:"algorithm-input-form",children:Object(g.jsxs)("form",{children:[Object(g.jsx)(m,{onChange:this.handleTextualInputChange("strategy").bind(this)}),Object(g.jsx)(f,{label:"Box Length",name:"box-length",value:this.state.boxLength,onChange:this.handleNumericalInputChange("boxLength").bind(this)}),Object(g.jsx)(f,{label:"Number of Rectangles",name:"num-rectangles",value:this.state.numRectangles,onChange:this.handleNumericalInputChange("numRectangles").bind(this)}),Object(g.jsx)(f,{label:"Min. Width",name:"min-width",value:this.state.minWidth,onChange:this.handleNumericalInputChange("minWidth").bind(this)}),Object(g.jsx)(f,{label:"Max. Width",name:"max-width",value:this.state.maxWidth,onChange:this.handleNumericalInputChange("maxWidth").bind(this)}),Object(g.jsx)(f,{label:"Min. Height",name:"min-height",value:this.state.minHeight,onChange:this.handleNumericalInputChange("minHeight").bind(this)}),Object(g.jsx)(f,{label:"Max. Height",name:"max-height",value:this.state.maxHeight,onChange:this.handleNumericalInputChange("maxHeight").bind(this)}),Object(g.jsx)("button",{onClick:this.startWithoutPageRefresh.bind(this),children:"Start"})]})})}}]),n}(a.Component),S=n(18),O=n(45),v=n.n(O),x=function(t){Object(s.a)(n,t);var e=Object(h.a)(n);function n(){var t;Object(l.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))).boxFillColor="white",t.boxBorderColor="black",t.rectangleFillColorBase="#D6E9FE",t.rectangleFillColorLatestUpdate="#5995DA",t.rectangleBorderColor="#5995DA",t.rectangleHighlightDuration=10,t.rectangleFillColormap=v()([t.rectangleFillColorBase,t.rectangleFillColorLatestUpdate]),t}return Object(u.a)(n,[{key:"render",value:function(){var t=this,e=this.props,n=e.id,a=e.unitLength,i=e.pixelLength,r=e.getRectangles,o=e.currentStep;function c(t){return t/a*i}var l=r().map((function(e,n){return function(e){var n=Math.max(0,(e.lastUpdate-o+t.rectangleHighlightDuration)/t.rectangleHighlightDuration);return Object(g.jsx)(S.c,{x:c(e.x),y:c(e.y),width:c(e.width),height:c(e.height),fill:t.rectangleFillColormap(n),stroke:t.rectangleBorderColor})}(e)}));return Object(g.jsx)("div",{className:"box",id:n,children:Object(g.jsx)(S.d,{width:i,height:i,children:Object(g.jsxs)(S.b,{children:[Object(g.jsx)(S.c,{x:0,y:0,width:i,height:i,fill:this.boxFillColor,stroke:this.boxBorderColor}),Object(g.jsx)(S.a,{x:0,y:0,children:l})]})})})}}]),n}(a.Component),C=function(t){Object(s.a)(n,t);var e=Object(h.a)(n);function n(){var t;Object(l.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))).getCurrentSolutionStep=t.props.getCurrentSolutionStep,t.getRectanglesLastUpdate=t.props.getRectanglesLastUpdate,t.state={placement:[]},t.boxPixelLength=300,t}return Object(u.a)(n,[{key:"getRectanglesLastUpdateWithZeroDefault",value:function(t){var e=this.getRectanglesLastUpdate()[t];return void 0!==e?e:0}},{key:"getRectangles",value:function(t){var e=this;return function(){return e.state.placement.filter((function(e){return e.box.id===t})).map((function(t){return{x:t.coordinates.x,y:t.coordinates.y,width:t.rectangle.width,height:t.rectangle.height,lastUpdate:e.getRectanglesLastUpdateWithZeroDefault(t.rectangle.id)}}))}}},{key:"getUnique",value:function(t){return Object(o.a)(new Set(t.map((function(t){return t.id})))).map((function(e){return t.find((function(t){return t.id===e}))}))}},{key:"render",value:function(){var t=this,e=this.getCurrentSolutionStep();void 0!==e&&e.solution.placement!==this.state.placement&&(this.setState({placement:e.solution.placement}),console.log("Visualize solution step "+e.step+" for run with id "+e.runId));var n=this.getUnique(this.state.placement.map((function(t){return t.box}))).sort((function(t,e){return t.id-e.id})).map((function(n){return Object(g.jsx)(x,{id:n.id,unitLength:n.width,pixelLength:t.boxPixelLength,getRectangles:t.getRectangles(n.id),currentStep:e.step})}));return Object(g.jsx)("div",{className:"algorithm-display",children:Object(g.jsx)("div",{className:"boxes-container",children:n})})}}]),n}(a.Component),y=function(t){Object(s.a)(n,t);var e=Object(h.a)(n);function n(){return Object(l.a)(this,n),e.apply(this,arguments)}return Object(u.a)(n,[{key:"render",value:function(){var t=this.props,e=t.getCurrentSolutionStep,n=t.getRectanglesLastUpdate,a=t.start;return Object(g.jsxs)("div",{className:"content-container",children:[Object(g.jsx)(j,{start:a}),Object(g.jsx)(C,{getCurrentSolutionStep:e,getRectanglesLastUpdate:n})]})}}]),n}(a.Component),I=n(19),R=n.n(I),k=function(){function t(){Object(l.a)(this,t);var e=Object({NODE_ENV:"production",PUBLIC_URL:"/bin-packing-algorithms",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_HOST;"undefined"==typeof e&&(e="localhost");var n=Object({NODE_ENV:"production",PUBLIC_URL:"/bin-packing-algorithms",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_API_PORT;"undefined"==typeof n&&(n=9e3),R.a.defaults.baseURL="http://"+e+":"+n,console.info("Setup API connection to "+R.a.defaults.baseURL)}return Object(u.a)(t,[{key:"startAlgorithm",value:function(t,e,n,a,i,r,o){return function(c){console.trace("Starting algorithm"),R.a.put("/binPacking/start",{strategy:t,boxLength:e,numRectangles:n,rectanglesWidthRange:{min:a,max:i},rectanglesHeightRange:{min:r,max:o}}).then((function(t){return c(t)}))}}},{key:"fetchSolutionSteps",value:function(t,e,n){return function(a){console.trace("Fetching steps "+e+" - "+n+" for runId "+t),R.a.get("/binPacking/steps",{params:{runId:t,minStep:e,maxStep:n}}).then((function(t){return a(t)}))}}}]),t}(),L=function(){function t(){Object(l.a)(this,t)}return Object(u.a)(t,null,[{key:"zipPlacementsByRectangleId",value:function(t,e){function n(t,e){return t.rectangle.id-e.rectangle.id}return function t(e,a){if(0===e.length)return a.map((function(t){return{left:null,right:t}}));if(0===a.length)return e.map((function(t){return{left:t,right:null}}));var i=e[0],r=a[0],c=n(i,r);return 0===c?[{left:i,right:r}].concat(Object(o.a)(t(e.slice(1),a.slice(1)))):c<0?[{left:i,right:null}].concat(Object(o.a)(t(e.slice(1),a))):[{left:null,right:r}].concat(Object(o.a)(t(e,a.slice(1))))}(Object(o.a)(t).sort(n),Object(o.a)(e).sort(n))}}]),t}();function U(t){return t[t.length-1]}var F=function(t){Object(s.a)(n,t);var e=Object(h.a)(n);function n(){var t;Object(l.a)(this,n);for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];return(t=e.call.apply(e,[this].concat(i))).fetchSolutionStepsPeriod=100,t.fetchSolutionStepsCount=100,t.removeFirstSolutionStepFromQueuePeriod=100,t.backendClient=new k,t.state={running:!1,runId:"",fetchBlocked:!1,solutionStepQueue:[],rectanglesLastUpdate:{}},t.getCurrentSolutionStep=function(){return t.state.solutionStepQueue[0]},t.getRectanglesLastUpdate=function(){return t.state.rectanglesLastUpdate},t.start=function(e,n,a,i,r,o,l){t.backendClient.startAlgorithm(e,n,a,i,r,o,l)((function(e){console.log(e),t.setState((function(t){return Object(c.a)(Object(c.a)({},t),{},{running:!0,runId:e.data.runId,solutionStepQueue:[e.data],rectanglesLastUpdate:{}})}))}))},t.blockFetch=function(){t.setState((function(t){return Object(c.a)(Object(c.a)({},t),{},{fetchBlocked:!0})}))},t.fetchSolutionSteps=function(){t.blockFetch();var e=U(t.state.solutionStepQueue).step;t.backendClient.fetchSolutionSteps(t.state.runId,e+1,e+t.fetchSolutionStepsCount)((function(e){console.log(e);var n=e.data.length>0&&U(e.data).finished;t.setState((function(a){return Object(c.a)(Object(c.a)({},a),{},{running:!n,fetchBlocked:!1,solutionStepQueue:[].concat(Object(o.a)(t.state.solutionStepQueue),Object(o.a)(e.data))})}))}))},t.getUpdatedRectangleIdsInNewStep=function(t,e){return L.zipPlacementsByRectangleId(t.solution.placement,e.solution.placement).map((function(t){return null===t.left?t.right.rectangle.id:null===t.right||t.left.coordinates.x!==t.right.coordinates.x||t.left.coordinates.y!==t.right.coordinates.y?t.left.rectangle.id:null})).filter((function(t){return null!==t}))},t.removeFirstSolutionStepFromQueue=function(){if(t.state.solutionStepQueue.length>1){var e=t.state.solutionStepQueue[0],n=t.state.solutionStepQueue.slice(1),a=n[0],i=Object(c.a)({},t.state.rectanglesLastUpdate);t.getUpdatedRectangleIdsInNewStep(e,a).forEach((function(t){return i[t]=a.step})),t.setState((function(t){return Object(c.a)(Object(c.a)({},t),{},{solutionStepQueue:n,rectanglesLastUpdate:i})}))}},t}return Object(u.a)(n,[{key:"componentDidMount",value:function(){var t=this;this.fetchSolutionStepsInterval=setInterval((function(){t.state.running&&!t.state.fetchBlocked&&t.fetchSolutionSteps()}),this.fetchSolutionStepsPeriod),this.removeFirstSolutionStepFromQueueInterval=setInterval(this.removeFirstSolutionStepFromQueue,this.removeFirstSolutionStepFromQueuePeriod)}},{key:"componentWillUnmount",value:function(){clearInterval(this.fetchSolutionStepsInterval),clearInterval(this.removeFirstSolutionStepFromQueueInterval)}},{key:"render",value:function(){return Object(g.jsxs)("div",{className:"main",children:[Object(g.jsx)(d,{}),Object(g.jsx)(y,{getCurrentSolutionStep:this.getCurrentSolutionStep,getRectanglesLastUpdate:this.getRectanglesLastUpdate,start:this.start})]})}}]),n}(a.Component);r.a.render(Object(g.jsx)(F,{}),document.getElementById("root"))},49:function(t,e,n){}},[[115,1,2]]]);
//# sourceMappingURL=main.6888abc1.chunk.js.map